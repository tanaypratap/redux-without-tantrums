<!DOCTYPE html>
<html>
	<head>
	<title>Redux Basic</title>
    <script src="https://npmcdn.com/redux@latest/dist/redux.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	</head>

	<body>
		<div class="container">

			<div class="jumbotron"><h2> Redux Basics </h2> <p class="lead">....without tantrums</p></div>


			<div class=" col-md-4 col-md-offset-4 well">
				<h4> Create your shopping items</h4>

				<input type="text" id="enterItem" class="form-control"></input>
				<br/><button id="Add" class="btn btn-default pull-right">Add</button>

			</div>

			<div  class=" col-md-4 col-md-offset-4 well">
				<h4> Your Added items:</h4>

				<ul id="list">

				</ul>

			</div>

		</div>

		<script>
		// Define a constant for the type of action
		var ADD_ITEM = 'ADD_ITEM';
		var REMOVE_ITEM = 'REMOVE_ITEM';

		// Define what the action will need i.e. its paylod
		function addItem(text){
			return {type: ADD_ITEM, text}
		}

		function removeItem(index) {
			return {type: REMOVE_ITEM, index}
		}

		// reducer function to use the object returned by addItem
		function listItem(state, action) {
			if (typeof state === 'undefined') {
				return []
			}

			switch(action.type) {
				case ADD_ITEM:
					var addedArray = state.slice();
					addedArray.push(action.text);
					return addedArray; // See that the state is not modified.

				case REMOVE_ITEM:
					var removedArray = state.filter(function(value, index){
							if (index==action.index) return false;
							else return true;
						});
					return removedArray;

				default:
					return state
			}
		}

		//Creating the Redux store
		var store = Redux.createStore(listItem);

		//Render function for displaying the current store state
		function render() {
			var items = store.getState();
			htmlList = items.reduce(function(prev, item, index) {
				return prev + "<li onclick=removefromList("+index+")>" + item + "</li>";
				}, "");
			document.getElementById("list").innerHTML = htmlList;
			}

		//Initial render
		render();

		//Subscribing the changes to store, calling render on store change
		store.subscribe(render);

		//Changing previous code to dispatch actions on click
		// instead of changing the value itself
			document.getElementById('Add')
				.addEventListener('click', function() {
					var text = document.getElementById('enterItem').value;
					store.dispatch(addItem(text));
					document.getElementById('enterItem').value = '';

				});

			function removefromList(index) {
				store.dispatch(removeItem(index));
				}

		</script>

	</body>


</html>
